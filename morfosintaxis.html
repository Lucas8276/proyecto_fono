<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ruleta Personajes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    .ruleta.ruleta-rosada {
      position: relative;
      width: 650px;
      height: 560px;
      border-radius: 50%;
      margin: 50px auto;
      background: conic-gradient(
        #ffb6c1 0deg 60deg,
        #ff69b4 60deg 120deg,
        #ff6f91 120deg 180deg,
        #ff8fab 180deg 240deg,
        #fcb1d1 240deg 300deg,
        #f88379 300deg 360deg
      );
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ruleta.ruleta-verde {
      position: relative;
      width: 650px;
      height: 560px;
      border-radius: 50%;
      margin: 50px auto;
      background: conic-gradient(
        #1b4d3e 0deg 60deg,
        #eac39a 60deg 120deg,
        #b7a96b 120deg 180deg,
        #3b6b4d 180deg 240deg,
        #7a9b5b 240deg 300deg,
        #e6a04e 300deg 360deg
      );
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ruleta {
      position: relative;
      width: 650px;
      height: 560px;
      border-radius: 50%;
      margin: 50px auto;
      background: conic-gradient(
        #50C4ED 0deg 60deg,
        #4681A1 60deg 120deg,
        #3C5F7B 120deg 180deg,
        #3CA4BF 180deg 240deg,
        #4EC8C0 240deg 300deg,
        #63D6ED 300deg 360deg
      );
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ruleta .centro {
      position: absolute;
      width: 120px;
      height: 120px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-family: Arial, sans-serif;
      z-index: 2;
      text-align: center;
      font-size: 2 rem;
      transition: transform 0.3s cubic-bezier(.17,.67,.83,.67), font-size 0.2s cubic-bezier(.17,.67,.83,.67);
      cursor: pointer;
    }
    .ruleta .centro:hover {
      transform: scale(1.1);
      font-size: 1.5rem;
    }

    .ruleta .icono {
      position: absolute;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      overflow: hidden;
      background: white;
      box-shadow: 0 2px 8px rgba(80,196,237,0.10);
      z-index: 1;
      left: 50%;
      top: 50%;
      transform-origin: center center;
      /* El transform se ajusta dinámicamente por JS */
    }

    .ruleta .icono img {
      width: 92%;
      height: 92%;
      object-fit: contain;
      border-radius: 50%;
      display: block;
      margin: auto;
      mask-image: radial-gradient(circle, white 98%, transparent 100%);
      -webkit-mask-image: radial-gradient(circle, white 98%, transparent 100%);
      box-shadow: 0 2px 8px rgba(80,196,237,0.10);
      background: #fff;
    }
  </style>
</head>
<body>
<div style="width:100%;display:flex;justify-content:flex-end;margin-top:18px;margin-bottom:-18px;">
  <button onclick="window.location.href='index.html'" style="background:#4681A1;color:white;border:none;border-radius:10px;padding:10px 28px;font-size:1.1em;font-weight:bold;cursor:pointer;transition:background 0.2s;">Volver al inicio</button>
</div>

<div id="contenedorRuletaAzul" class="contenedor-principal" style="display: flex; justify-content: center; align-items: flex-start; gap: 40px; margin-top: 40px; margin-bottom: 40px; background: #f4fafd; border-radius: 22px; box-shadow: 0 6px 24px rgba(80,196,237,0.10); padding: 32px 24px; max-width: 900px; margin-left: auto; margin-right: auto;">
  <div class="ruleta">
    <div class="centro" id="centroRuleta">PERSONAJES</div>
    <!-- Íconos distribuidos en círculo -->
    <div class="icono"><img src="images/fonologia/nena.png" alt="Niña" title="Niña"></div>
    <div class="icono"><img src="images/morfosintaxis/perro.jpg" alt="Perro" title="Perro"></div>
    <div class="icono"><img src="images/morfosintaxis/pulpo.jpg" alt="Pulpo" title="Pulpo"></div>
    <div class="icono"><img src="images/morfosintaxis/monstruo.jpg" alt="Monstruo" title="Monstruo"></div>
    <div class="icono"><img src="images/morfosintaxis/astronauta.jpg" alt="Astronauta" title="Astronauta"></div>
    <div class="icono"><img src="images/morfosintaxis/hada.jpg" alt="Hada" title="Hada"></div>
  </div>
  <div class="recuadro-texto" style="display: flex; flex-direction: column; align-items: center;">
    <label for="respuestaUsuario" style="font-weight: bold; margin-bottom: 8px; color: #3C5F7B;">Escribe tu respuesta:</label>
    <textarea id="respuestaUsuario" rows="8" cols="28" placeholder="Escribe aquí tu oración..." style="resize: none; border-radius: 12px; border: 2px solid #50C4ED; padding: 10px; font-size: 1.1em; background: #f8fcff;"></textarea>
    <button id="btnSiguiente" style="margin-top: 18px; display: none; background: #50C4ED; color: white; border: none; border-radius: 10px; padding: 10px 28px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background 0.2s;">Siguiente</button>
  </div>
</div>

<div id="contenedorRuletaRosada" class="contenedor-principal" style="display: none; justify-content: center; align-items: flex-start; gap: 40px; margin-top: 40px; margin-bottom: 40px; background: #fff0f6; border-radius: 22px; box-shadow: 0 6px 24px rgba(237,80,196,0.10); padding: 32px 24px; max-width: 900px; margin-left: auto; margin-right: auto;">
  <div class="ruleta ruleta-rosada">
    <div class="centro" id="centroRuletaRosada">OBJETOS</div>
    <div class="icono"><img src="images/semantica/pelota.png" alt="Pelota" title="Pelota"></div>
    <div class="icono"><img src="images/semantica/manzanaa.png" alt="Manzana" title="Manzana"></div>
    <div class="icono"><img src="images/fonetica/objects/flor.jpg" alt="Flor" title="Flor"></div>
    <div class="icono"><img src="images/fonetica/objects/guitarra.jpg" alt="Guitarra" title="Guitarra"></div>
    <div class="icono"><img src="images/semantica/libro.png" alt="Libro" title="Libro"></div>
    <div class="icono"><img src="images/lapiz.png" alt="Lapiz" title="Lapiz"></div>
  </div>
  <div class="recuadro-texto" style="display: flex; flex-direction: column; align-items: center;">
    <label for="respuestaUsuarioRosada" style="font-weight: bold; margin-bottom: 8px; color: #653c7b;">Escribe tu respuesta:</label>
    <textarea id="respuestaUsuarioRosada" rows="8" cols="28" placeholder="Escribe aquí tu oración..." style="resize: none; border-radius: 12px; border: 2px solid #ed50cb; padding: 10px; font-size: 1.1em; background: #f8fcff;"></textarea>
    <button id="btnSiguienteR" style="margin-top: 18px; display: none; background: #50C4ED; color: white; border: none; border-radius: 10px; padding: 10px 28px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background 0.2s;">Siguiente</button>
  </div>
</div>

<div id="contenedorRuletaVerde" class="contenedor-principal" style="display: none; justify-content: center; align-items: flex-start; gap: 40px; margin-top: 40px; margin-bottom: 40px; background: #f0fff8; border-radius: 22px; box-shadow: 0 6px 24px rgba(237,80,196,0.10); padding: 32px 24px; max-width: 900px; margin-left: auto; margin-right: auto;">
  <div class="ruleta ruleta-verde">
    <div class="centro" id="centroRuletaVerde">LUGARES</div>
    <div class="icono"><img src="images/morfosintaxis/granja.jpg" alt="Granja" title="Granja"></div>
    <div class="icono"><img src="images/morfosintaxis/casa.jpg" alt="Casa" title="Casa"></div>
    <div class="icono"><img src="images/morfosintaxis/carpa.jpg" alt="Carpa" title="Carpa"></div>
    <div class="icono"><img src="images/morfosintaxis/carrito.png" alt="Carrito" title="Carrito"></div>
    <div class="icono"><img src="images/morfosintaxis/planetas.jpg" alt="Planeta" title="Planeta"></div>
    <div class="icono"><img src="images/morfosintaxis/playa.png" alt="Playa" title="Playa"></div>
  </div>
  <div class="recuadro-texto" style="display: flex; flex-direction: column; align-items: center;">
    <label for="respuestaUsuarioVerde" style="font-weight: bold; margin-bottom: 8px; color: #3c7b52;">Escribe tu respuesta:</label>
    <textarea id="respuestaUsuarioVerde" rows="8" cols="28" placeholder="Escribe aquí tu oración..." style="resize: none; border-radius: 12px; border: 2px solid #50ed94; padding: 10px; font-size: 1.1em; background: #f8fcff;"></textarea>
    <button id="btnFinalizar" style="margin-top: 18px; background: #3c7b52; color: white; border: none; border-radius: 10px; padding: 10px 28px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background 0.2s;">Finalizar</button>
  </div>
</div>
<script>
// Variables y lógica para la ruleta azul
const ruleta = document.querySelector('.ruleta');
const iconos = document.querySelectorAll('#contenedorRuletaAzul .icono');
const personajes = [
  { nombre: 'Niña',    angulo: 12 },
  { nombre: 'Perro',   angulo: 70 },
  { nombre: 'Pulpo',   angulo: 160 },
  { nombre: 'Monstruo',angulo: 235 },
  { nombre: 'Astronauta', angulo: 278 },
  { nombre: 'Hada',    angulo: 325 }
];

const personajes_R = [
  { nombre: 'Pelota',    angulo: 12 },
  { nombre: 'Manzana',   angulo: 70 },
  { nombre: 'Flor',   angulo: 160 },
  { nombre: 'Guitarra',angulo: 235 },
  { nombre: 'Libro', angulo: 278 },
  { nombre: 'Lapiz',    angulo: 325 }
];

const personajes_V = [
  { nombre: 'Granja',    angulo: 12 },
  { nombre: 'Casa',   angulo: 70 },
  { nombre: 'Carpa',   angulo: 160 },
  { nombre: 'Carrito',angulo: 235 },
  { nombre: 'Planeta', angulo: 278 },
  { nombre: 'Playa',    angulo: 325 }
];
let girando = false;



// Distribuir iconos en círculo y mantener orientación para la ruleta azul
iconos.forEach((icono, i) => {
  const angulo = personajes[i].angulo;
  let radio;
  if (i === 0) {
    radio = 170;
  } else if (i === 1) {
    radio = 110;
  } else if (i === 2) {
    radio = 80;
  } else if (i === 3) {
    radio = 120;
  } else if (i === 4) {
    radio = 200;
  } else if (i === 5) {
    radio = 200;
  }
  icono.style.transform = `rotate(${angulo}deg) translateY(-${radio}px) rotate(${-angulo}deg)`;
  icono.style.left = "50%";
  icono.style.top = "50%";
});

function girarRuleta() {
  if (girando) return;
  girando = true;
  const secciones = personajes.length;
  const seccion = Math.floor(Math.random() * secciones);
  const vueltas = 5;
  const anguloFinal = 360 * vueltas + (360 / secciones) * seccion + (360 / secciones) / 2;
  ruleta.style.transition = 'transform 4s cubic-bezier(.17,.67,.83,.67)';
  ruleta.style.transform = `rotate(${anguloFinal}deg)`;

  setTimeout(() => {
    ruleta.style.transition = '';
    ruleta.style.transform = `rotate(${(360 / secciones) * seccion + (360 / secciones) / 2}deg)`;
    girando = false;
    alert('¡Salió: ' + personajes[seccion].nombre + '!');
    chequearMostrarSiguiente();
  }, 4000);
}

document.getElementById('centroRuleta').addEventListener('click', girarRuleta);

function chequearMostrarSiguiente() {
  const respuesta = document.getElementById('respuestaUsuario').value.trim();
  if (respuesta.length > 0) {
    document.getElementById('btnSiguiente').style.display = 'block';
  } else {
    document.getElementById('btnSiguiente').style.display = 'none';
  }
}
document.getElementById('respuestaUsuario').addEventListener('input', chequearMostrarSiguiente);

// Mostrar botón solo si ya giró la ruleta y hay texto
// El botón se muestra desde girarRuleta() si hay texto

// Al hacer click en siguiente, ocultar azul y mostrar rosada
const btnSiguiente = document.getElementById('btnSiguiente');
btnSiguiente.addEventListener('click', function() {
  document.getElementById('contenedorRuletaAzul').style.display = 'none';
  document.getElementById('contenedorRuletaRosada').style.display = 'flex';
});

function chequearMostrarSiguienteR() {
  const respuesta = document.getElementById('respuestaUsuario').value.trim();
  if (respuesta.length > 0) {
    document.getElementById('btnSiguienteR').style.display = 'block';
  } else {
    document.getElementById('btnSiguienteR').style.display = 'none';
  }
}
document.getElementById('respuestaUsuarioRosada').addEventListener('input', chequearMostrarSiguienteR);

// Mostrar botón solo si ya giró la ruleta y hay texto
// El botón se muestra desde girarRuleta() si hay texto

// Al hacer click en siguiente, ocultar azul y mostrar rosada
const btnSiguienteR = document.getElementById('btnSiguienteR');
btnSiguienteR.addEventListener('click', function() {
  document.getElementById('contenedorRuletaRosada').style.display = 'none';
  document.getElementById('contenedorRuletaVerde').style.display = 'flex';
});

// Segunda ruleta funcionalidad
const ruletaRosada = document.querySelector('.ruleta-rosada');
const iconosRosada = ruletaRosada.querySelectorAll('.icono');
let girandoRosada = false;
iconosRosada.forEach((icono, i) => {
  const angulo = personajes_R[i].angulo;
  let radio;
  if (i === 0) {
    radio = 170;
  } else if (i === 1) {
    radio = 110;
  } else if (i === 2) {
    radio = 80;
  } else if (i === 3) {
    radio = 120;
  } else if (i === 4) {
    radio = 200;
  } else if (i === 5) {
    radio = 200;
  }
  icono.style.transform = `rotate(${angulo}deg) translateY(-${radio}px) rotate(${-angulo}deg)`;
  icono.style.left = "50%";
  icono.style.top = "50%";
});

function girarRuletaRosada() {
  if (girandoRosada) return;
  girandoRosada = true;
  const secciones = personajes_R.length;
  const seccion = Math.floor(Math.random() * secciones);
  const vueltas = 5;
  const anguloFinal = 360 * vueltas + (360 / secciones) * seccion + (360 / secciones) / 2;
  ruletaRosada.style.transition = 'transform 4s cubic-bezier(.17,.67,.83,.67)';
  ruletaRosada.style.transform = `rotate(${anguloFinal}deg)`;

  setTimeout(() => {
    ruletaRosada.style.transition = '';
    ruletaRosada.style.transform = `rotate(${(360 / secciones) * seccion + (360 / secciones) / 2}deg)`;
    girandoRosada = false;
    alert('¡Salió: ' + personajes_R[seccion].nombre + '!');
  }, 4000);
}
document.getElementById('centroRuletaRosada').addEventListener('click', girarRuletaRosada);

const ruletaVerde = document.querySelector('.ruleta-verde');
const iconosVerde = ruletaVerde.querySelectorAll('.icono');
let girandoVerde = false;
iconosVerde.forEach((icono, i) => {
  const angulo = personajes_V[i].angulo;
  let radio;
  if (i === 0) {
    radio = 170;
  } else if (i === 1) {
    radio = 110;
  } else if (i === 2) {
    radio = 80;
  } else if (i === 3) {
    radio = 120;
  } else if (i === 4) {
    radio = 200;
  } else if (i === 5) {
    radio = 200;
  }
  icono.style.transform = `rotate(${angulo}deg) translateY(-${radio}px) rotate(${-angulo}deg)`;
  icono.style.left = "50%";
  icono.style.top = "50%";
});

function enviarDatosAlServidor() {
  const paciente_nombre = localStorage.getItem('nombre');
  const paciente_edad = localStorage.getItem('edad');
    const paciente_juego = 'Morfosintaxis';
    const paciente_resultado = 'Completado';
    fetch('http://localhost:3000/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `nombre=${encodeURIComponent(paciente_nombre)}&edad=${encodeURIComponent(paciente_edad)}&paciente_juego=${encodeURIComponent(paciente_juego)}&paciente_resultado=${encodeURIComponent(paciente_resultado)}`
            })
            .then(response => {
                if (response.ok) {
                    Swal.fire('¡Datos guardados!', 'El resultado se ha registrado correctamente.', 'success');
                } else {
                    Swal.fire('Error', 'No se pudieron guardar los datos.', 'error');
                }
            })
            .catch(() => {
                Swal.fire('Error', 'No se pudieron guardar los datos.', 'error');
            });
}
function girarRuletaVerde() {
  if (girandoVerde) return;
  girandoVerde = true;
  const secciones = personajes_V.length;
  const seccion = Math.floor(Math.random() * secciones);
  const vueltas = 5;
  const anguloFinal = 360 * vueltas + (360 / secciones) * seccion + (360 / secciones) / 2;
  ruletaVerde.style.transition = 'transform 4s cubic-bezier(.17,.67,.83,.67)';
  ruletaVerde.style.transform = `rotate(${anguloFinal}deg)`;

  setTimeout(() => {
    ruletaVerde.style.transition = '';
    ruletaVerde.style.transform = `rotate(${(360 / secciones) * seccion + (360 / secciones) / 2}deg)`;
    girandoVerde = false;
    alert('¡Salió: ' + personajes_V[seccion].nombre + '!');
    // Aquí se llama a la función para enviar los datos al backend al finalizar el juego
    enviarDatosAlServidor();
  }, 4000);
}
document.getElementById('centroRuletaVerde').addEventListener('click', girarRuletaVerde);
document.getElementById('btnFinalizar').addEventListener('click', function() {
  enviarDatosAlServidor();
});
</script>

</body>
</html>
