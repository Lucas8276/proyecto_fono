<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pragmática - Nivel 3</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="../css/pragmatica.css" rel="stylesheet">
</head>

<body>
<div class="container">
    <h1>¿Qué está pasando en esta situación?</h1>
    <div class="image-box">
      <img id="situationImage" src="" alt="Situación">
    </div>
    <h2 id="preguntaTexto"></h2>
    <div class="options" id="optionsContainer"></div>
  </div>

  <script>
    const imagenes = [
  {
    src: "imagenes/nenallorando.png",
    preguntas: [
      {
        texto: "¿Qué podrías decir si estuvieras ahí?",
        opciones: ["¿Querés que te ayude?", "¡Dejá de llorar!", "¡Qué fea estás!"],
        correcta: "¿Querés que te ayude?"
      },
      {
        texto: "¿Qué no sería correcto decir? ¿Por qué?",
        opciones: ["¿Te duele algo?", "¡Qué tonta sos por llorar!", "¿Querés un abrazo?"],
        correcta: "¡Qué tonta sos por llorar!"
      },
      {
        texto: "¿Qué harías para ayudar o mejorar la situación?",
        opciones: ["Irme sin decir nada", "Pedirle que se calme con gritos", "Escucharla y quedarme con ella"],
        correcta: "Escucharla y quedarme con ella"
      }
    ]
  },
  {
    src: "imagenes/nenespeleando.png",
    preguntas: [
      {
        texto: "¿Qué podrías decir si estuvieras ahí?",
        opciones: ["¿Por qué se pelean?", "¡Péguense más fuerte!", "¡Yo también quiero pelear!"],
        correcta: "¿Por qué se pelean?"
      },
      {
        texto: "¿Qué no sería correcto decir? ¿Por qué?",
        opciones: ["¡Paren por favor!", "¡Sigan peleando que es divertido!", "¿Qué pasó entre ustedes?"],
        correcta: "¡Sigan peleando que es divertido!"
      },
      {
        texto: "¿Qué harías para ayudar o mejorar la situación?",
        opciones: ["Llamar a un adulto", "Filmar la pelea con el celular", "Gritar que gané yo"],
        correcta: "Llamar a un adulto"
      }
    ]
  },
  {
    src: "imagenes/nenaspeleando.png",
    preguntas: [
      {
        texto: "¿Qué podrías decir si estuvieras ahí?",
        opciones: ["¿Pueden turnarse con el oso?", "¡El oso es mío!", "¡Rompan el juguete!"],
        correcta: "¿Pueden turnarse con el oso?"
      },
      {
        texto: "¿Qué no sería correcto decir? ¿Por qué?",
        opciones: ["¡Peleen hasta que una gane!", "¿Por qué no lo comparten?", "¿Les presto otro juguete?"],
        correcta: "¡Peleen hasta que una gane!"
      },
      {
        texto: "¿Qué harías para ayudar o mejorar la situación?",
        opciones: ["Buscar otro juguete para compartir", "Empujar a una de las nenas", "Reírme de la pelea"],
        correcta: "Buscar otro juguete para compartir"
      }
    ]
  }
];

    const imagenSeleccionada = imagenes[Math.floor(Math.random() * imagenes.length)];
    let preguntaIndex = 0;
    let aciertos = 0;
    let desaciertos = 0;

    function mostrarPregunta() {
      const pregunta = imagenSeleccionada.preguntas[preguntaIndex];
      document.getElementById("situationImage").src = imagenSeleccionada.src;
      document.getElementById("preguntaTexto").textContent = pregunta.texto;

      const container = document.getElementById("optionsContainer");
      container.innerHTML = "";

      pregunta.opciones.forEach(opcion => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = opcion;

        btn.onclick = () => {
          if (btn.disabled) return;

          if (opcion === pregunta.correcta) {
            aciertos++;
            btn.classList.add("correcta");
            Swal.fire("¡Correcto!", "", "success").then(() => {
              siguientePregunta();
            });
          } else {
            desaciertos++;
            btn.disabled = true;
            btn.style.opacity = "0.6";
            Swal.fire("Incorrecto", "Intentá de nuevo.", "error");
          }
        };

        container.appendChild(btn);
      });
    }

    function siguientePregunta() {
      preguntaIndex++;
      if (preguntaIndex < imagenSeleccionada.preguntas.length) {
        mostrarPregunta();
      } else {
        enviarResultados();
      }
    }

    function enviarResultados() {
      const id_paciente = localStorage.getItem('id_paciente');

      if (!id_paciente) {
        Swal.fire("Error", "ID de paciente no encontrado en localStorage", "error");
        return;
      }

      const data = {
        id_paciente: parseInt(id_paciente),
        paciente_juego: "Pragmática - Nivel 2",
        paciente_resultado: `${aciertos} aciertos, ${desaciertos} desaciertos`,
        paciente_acierto: aciertos,
        paciente_desacierto: desaciertos
      };

    fetch('http://localhost:3000/juegos', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(response => {
    if (!response.ok) throw new Error('Error al guardar los resultados');
    return response.text();
  })
.then(msg => {
    console.log(msg);
    Swal.fire("¡Nivel completado!", "Resultados guardados exitosamente.", "success").then(() => {
      window.location.href = "index.html"; 
    });
  })
  .catch(err => {
    console.error(err);
    Swal.fire("Error", "No se pudieron guardar los resultados", "error");
  });
}

    mostrarPregunta();
  </script>
</body>
</html>
